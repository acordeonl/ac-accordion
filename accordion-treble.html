<imports >
    <link rel="import" href="/bower_components/polymer/polymer.html">
    <link rel="import" href="/bower_components/ac-view/ac-led-group-behavior.html">
    <link rel="import" href="/bower_components/ac-view/view-audio.html">
    <link rel="import" href="/bower_components/local-dom/local-dom.html">
    <link rel="import" href="./accordion-ac-led.html">
</imports>
<!--

Shows drop down menu (works on chrome)

### Usage
The list displayed in the drop down menu can be set as an attribute.

    <drop-menu list-items='["first" ,"second"]'></drop-menu>

For an overlayed drop menu:

    <drop-menu overlay-menu list-items='["first" ,"second"]'></drop-menu>

### Styling
 Custom property | Description | Default
----------------|-------------|----------
`--item-background-color` | List item backround color | `#f1ecef`
`--item-color` | List item color used for fonts | `#302f31`
`--button-close-color` | Icon button hover color | `4775D1`
`--button-background-color` | Drop menu's background color | `white`
`--button-close-color` | Icon button hover color | `4775D1`
`--icon-button` | Mixin applied the icon button | `{}`

@demo demo/drop-menu-demo.html
-->
<dom-module id="accordion-treble">
    <template>
        <style>
            :host {}
            local-dom {
                height: 100vh;
                width: 100%;
                @apply(--layout-center);
                @apply(--layout-justified);
                @apply(--layout-horizontal);
            }
            .col1 {
                height: 82vh;
                margin: 0;
                padding: 0;
                /*@apply(--layout-vertical);*/
                @apply(--layout-justified);
            }
            .col2 {
                height: 92vh;
                padding: 0;
                /*margin-left: -0.3vh;
                margin-right: -0.3vh;*/
                /*@apply(--layout-vertical);*/
                @apply(--layout-justified);
            }
            [mobile] .col2 {
                padding: 0;
            }
            [tablet] .col2 {
                padding: 0;
            }
            .vertical {
                @apply(--layout-vertical);
            }
            .reversedVertical {
                @apply(--layout-vertical-reverse);
            }
            .reversedHorizontal {
                @apply(--layout-horizontal-reverse);
            }
            .horizontal {
                @apply(--layout-horizontal);
            }
        </style>
        <!-- local DOM -->
        <view-audio
            id="trebleAudio"
            channel='0' channel0
            total-notes='62'
            default-audio-url='/data/accordion_synth/treble'>
        </view-audio>
        <local-dom class$="{{_computeRotation(rotation)}}" mobile="{{mobile}}" tablet="{{tablet}}" laptop="{{laptop}}">
            <div class$="col1 {{_computeColRotation(rotation)}}">
                <accordion-ac-led acLed id21 channel0 ac-led-type="treble"></accordion-ac-led>
                <accordion-ac-led acLed id22 channel0 ac-led-type="treble"></accordion-ac-led>
                <accordion-ac-led acLed id23 channel0 ac-led-type="treble"></accordion-ac-led>
                <accordion-ac-led acLed id24 channel0 ac-led-type="treble"></accordion-ac-led>
                <accordion-ac-led acLed id25 channel0 ac-led-type="treble"></accordion-ac-led>
                <accordion-ac-led acLed id26 channel0 ac-led-type="treble"></accordion-ac-led>
                <accordion-ac-led acLed id27 channel0 ac-led-type="treble"></accordion-ac-led>
                <accordion-ac-led acLed id28 channel0 ac-led-type="treble"></accordion-ac-led>
                <accordion-ac-led acLed id29 channel0 ac-led-type="treble"></accordion-ac-led>
                <accordion-ac-led acLed id30 channel0 ac-led-type="treble"></accordion-ac-led>
            </div>
            <div class$="col2 {{_computeColRotation(rotation)}}">
                <accordion-ac-led acLed id10 channel0 ac-led-type="treble"></accordion-ac-led>
                <accordion-ac-led acLed id11 channel0 ac-led-type="treble"></accordion-ac-led>
                <accordion-ac-led acLed id12 channel0 ac-led-type="treble"></accordion-ac-led>
                <accordion-ac-led acLed id13 channel0 ac-led-type="treble"></accordion-ac-led>
                <accordion-ac-led acLed id14 channel0 ac-led-type="treble"></accordion-ac-led>
                <accordion-ac-led acLed id15 channel0 ac-led-type="treble"></accordion-ac-led>
                <accordion-ac-led acLed id16 channel0 ac-led-type="treble"></accordion-ac-led>
                <accordion-ac-led acLed id17 channel0 ac-led-type="treble"></accordion-ac-led>
                <accordion-ac-led acLed id18 channel0 ac-led-type="treble"></accordion-ac-led>
                <accordion-ac-led acLed id19 channel0 ac-led-type="treble"></accordion-ac-led>
                <accordion-ac-led acLed id20 channel0 ac-led-type="treble"></accordion-ac-led>
            </div>
            <div class$="col1 {{_computeColRotation(rotation)}}">
                <accordion-ac-led acLed id0 channel0 ac-led-type="treble"></accordion-ac-led>
                <accordion-ac-led acLed id1 channel0 ac-led-type="treble"></accordion-ac-led>
                <accordion-ac-led acLed id2 channel0 ac-led-type="treble"></accordion-ac-led>
                <accordion-ac-led acLed id3 channel0 ac-led-type="treble"></accordion-ac-led>
                <accordion-ac-led acLed id4 channel0 ac-led-type="treble"></accordion-ac-led>
                <accordion-ac-led acLed id5 channel0 ac-led-type="treble"></accordion-ac-led>
                <accordion-ac-led acLed id6 channel0 ac-led-type="treble"></accordion-ac-led>
                <accordion-ac-led acLed id7 channel0 ac-led-type="treble"></accordion-ac-led>
                <accordion-ac-led acLed id8 channel0 ac-led-type="treble"></accordion-ac-led>
                <accordion-ac-led acLed id9 channel0 ac-led-type="treble"></accordion-ac-led>
            </div>
        </local-dom>
    </template>
    <script>
        Polymer({
            is: "accordion-treble", observers: ['_swap(showingTreble)'],
            behaviors: [acLedGroupBehavior],
            properties: {
                // Mapping of button to instrument button closing note
                buttonCloseNote: {
                    type: Array,
                    value: []
                },
                // Mapping of button to instrument button opening note with
                buttonOpenNote: {
                    type: Array,
                    value: []
                },
                pitch:{
                    type:Number,
                    value:67
                }
            },

        /* ------------------- MIDI Events ------------------- */
            _mapMIDIEventToAcLedId: function(midiNote,channel){
                var acLedId = Math.floor((midiNote - 24) / 2);
                return acLedId ;
            },
            _mapMIDIEventToAcLedState: function(cmd,midiNote,channel){
                var acLedState = 0;
                if (cmd === 'note-on')
                    acLedState = ((midiNote - 24) % 2) + 1;
                return acLedState ;
            },
            _mapMIDIEventToMIDINote: function(acLedId,midiNote,channel){
                var note = this.buttonCloseNote[acLedId];
                if ((midiNote - 24) % 2)
                    note = this.buttonOpenNote[acLedId];
                return note ;
            },
        /* ------------------- Chords ------------------- */
            _displayChord: function(chord){
                console.log('will display ', chord , 'in treble');
            },
        /* ------------------- GUI ------------------- */
            _computeRotation: function(rotation){
                if( rotation )
                    return "reversedHorizontal" ;
                return "horizontal" ;
            },
            _computeColRotation: function(rotation){
                if( rotation )
                    return "reversedVertical" ;
                return "vertical" ;
            },
            _swap: function (showingTreble) {
                if (showingTreble) {
                    this.playAnimation('entry');
                }
            },
        /* ------------------- Setup ------------------- */
            _loadNotes: function () {
                var i;
                for (var i = 24; i < 86; i++) {
                    this._loadNote('trebleAudio', this.MIDIEventToNoteMap[0][i]);
                }

                // for (i = 0; i < 31; i++) {
                //     this._loadNote('trebleAudio', this.buttonCloseNote[i]);
                // }
                // for (i = 0; i < 31; i++) {
                //     this._loadNote('trebleAudio', this.buttonOpenNote[i]);
                // }
            },
            _setPitch: function (pitch) {
                var diff = pitch - this.pitch ;
                this.pitch += diff ;
                for (var i = 24; i < 86; i++) {
                    this.MIDIEventToNoteMap[0][i] += diff;
                }
            },
            ready: function () {
            /* ------------------- midi event note mapping ------------------- */
                this.MIDIEventToNoteMap[0][24] = 75;
                this.MIDIEventToNoteMap[0][25] = 73;
                this.MIDIEventToNoteMap[0][26] = 60;
                this.MIDIEventToNoteMap[0][27] = 64;
                this.MIDIEventToNoteMap[0][28] = 65;
                this.MIDIEventToNoteMap[0][29] = 67;
                this.MIDIEventToNoteMap[0][30] = 69;
                this.MIDIEventToNoteMap[0][31] = 70;
                this.MIDIEventToNoteMap[0][32] = 72;
                this.MIDIEventToNoteMap[0][33] = 74;
                this.MIDIEventToNoteMap[0][34] = 77;
                this.MIDIEventToNoteMap[0][35] = 76;
                this.MIDIEventToNoteMap[0][36] = 81;
                this.MIDIEventToNoteMap[0][37] = 79;
                this.MIDIEventToNoteMap[0][38] = 84;
                this.MIDIEventToNoteMap[0][39] = 82;
                this.MIDIEventToNoteMap[0][40] = 89;
                this.MIDIEventToNoteMap[0][41] = 86;
                this.MIDIEventToNoteMap[0][42] = 93;
                this.MIDIEventToNoteMap[0][43] = 88;
                this.MIDIEventToNoteMap[0][44] = 66;
                this.MIDIEventToNoteMap[0][45] = 68;
                this.MIDIEventToNoteMap[0][46] = 55;
                this.MIDIEventToNoteMap[0][47] = 59;
                this.MIDIEventToNoteMap[0][48] = 60;
                this.MIDIEventToNoteMap[0][49] = 62;
                this.MIDIEventToNoteMap[0][50] = 64;
                this.MIDIEventToNoteMap[0][51] = 65;
                this.MIDIEventToNoteMap[0][52] = 67;
                this.MIDIEventToNoteMap[0][53] = 69;
                this.MIDIEventToNoteMap[0][54] = 72;
                this.MIDIEventToNoteMap[0][55] = 71;
                this.MIDIEventToNoteMap[0][56] = 76;
                this.MIDIEventToNoteMap[0][57] = 74;
                this.MIDIEventToNoteMap[0][58] = 79;
                this.MIDIEventToNoteMap[0][59] = 77;
                this.MIDIEventToNoteMap[0][60] = 84;
                this.MIDIEventToNoteMap[0][61] = 81;
                this.MIDIEventToNoteMap[0][62] = 88;
                this.MIDIEventToNoteMap[0][63] = 83;
                this.MIDIEventToNoteMap[0][64] = 91;
                this.MIDIEventToNoteMap[0][65] = 86;
                this.MIDIEventToNoteMap[0][66] = 61;
                this.MIDIEventToNoteMap[0][67] = 63;
                this.MIDIEventToNoteMap[0][68] = 55;
                this.MIDIEventToNoteMap[0][69] = 57;
                this.MIDIEventToNoteMap[0][70] = 59;
                this.MIDIEventToNoteMap[0][71] = 60;
                this.MIDIEventToNoteMap[0][72] = 62;
                this.MIDIEventToNoteMap[0][73] = 64;
                this.MIDIEventToNoteMap[0][74] = 67;
                this.MIDIEventToNoteMap[0][75] = 66;
                this.MIDIEventToNoteMap[0][76] = 71;
                this.MIDIEventToNoteMap[0][77] = 69;
                this.MIDIEventToNoteMap[0][78] = 74;
                this.MIDIEventToNoteMap[0][79] = 72;
                this.MIDIEventToNoteMap[0][80] = 79;
                this.MIDIEventToNoteMap[0][81] = 76;
                this.MIDIEventToNoteMap[0][82] = 83;
                this.MIDIEventToNoteMap[0][83] = 78;
                this.MIDIEventToNoteMap[0][84] = 86;
                this.MIDIEventToNoteMap[0][85] = 81;

            }
        });
    </script>
</dom-module>
